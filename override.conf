# vim: set syntax=sh ts=8 sw=8 sts=0 noexpandtab :
#
# Additional repos for nrgaway
#
# Contains overrides specific to each branch as well as providing proper
# access to those with no ssh access to my repos

#
# for r2/r3 template branches
#

DEBUG = 1
VERBOSE = 2
NO_SIGN = 1

SNAPSHOT := 0
SYSTEMD_NSPAWN_ENABLE := 0
NO_CHECK = whonix-setup-wizard python-guimessages

GITHUB_PREFIX = $(word $(SSH_ACCESS), http://github.com/nrgaway git@github.com:nrgaway)
RELEASE_INDEX = $(shell echo "$(RELEASE)-1" | bc)

# Temp; rename for personal use so it does not have to be uninstalled each test
#TEMPLATE_LABEL := wheezy+whonix-gateway:whonix-gateway
#TEMPLATE_LABEL += fc21:fedora-21

[==- 'qubes-tools' =============================================================
[==- Personal development tools, research, notes, etc
[===============================================================================
COMPONENTS += qubes-tools
GIT_URL_qubes_tools = $(GITHUB_PREFIX)/qubes-tools.git
BRANCH_qubes_tools = $(word $(RELEASE_INDEX), master master)


[==- 'qubes-template-salt' =====================================================
[==- Development salt states, modules, etc
[===============================================================================
COMPONENTS += qubes-template-salt
GIT_URL_qubes_template_salt = $(GITHUB_PREFIX)/qubes-template-salt.git
BRANCH_qubes_template_salt = $(word $(RELEASE_INDEX), develop develop)


[==- 'qubes-whonix' ============================================================
[==- defaults: [R2:master, R3:master]
[===============================================================================
GIT_URL_qubes_whonix = $(GITHUB_PREFIX)/qubes-whonix.git
BRANCH_qubes_whonix = $(word $(RELEASE_INDEX), master master)


[==- 'whonix-setup-wizard' =====================================================
[==- defaults: [R2:master, R3:n/a]
[===============================================================================
ifneq (,$(findstring wheezy+whonix,$(DISTS_VM)))
COMPONENTS += whonix-setup-wizard
TEMPLATE += whonix-setup-wizard
GIT_URL_whonix_setup_wizard = https://github.com/Whonix/whonix-setup-wizard.git
BRANCH_whonix_setup_wizard = $(word $(RELEASE_INDEX), master master)

COMPONENTS += python-guimessages
TEMPLATE += python-guimessages
GIT_URL_python_guimessages = https://github.com/Whonix/python-guimessages.git
BRANCH_python_guimessages = $(word $(RELEASE_INDEX), master master)
endif


[==- 'qubes-builder' ===========================================================
[==- defaults: [R2:master, R3:master]
[===============================================================================
GIT_URL_qubes_builder = $(GITHUB_PREFIX)/qubes-builder.git
BRANCH_qubes_builder = $(word $(RELEASE_INDEX), templates templates)


[==- 'core-admin' ==============================================================
[==- defaults: [R2:release2, R3:master] ['core3']
[===============================================================================
#GIT_URL_core_admin = $(GITHUB_PREFIX)/core-admin.git
#BRANCH_core_admin = $(word $(RELEASE_INDEX), release2 master)


[==- 'linux-template-builder' ==================================================
[==- defaults: [R2:master, R3:master]
[==- branches: debian, ubuntu, fc21, whonix9.2, whonix9.4, whonix
[===============================================================================
GIT_URL_linux_template_builder = $(GITHUB_PREFIX)/linux-template-builder.git
BRANCH_linux_template_builder = $(word $(RELEASE_INDEX), templates templates)


[==- 'core-agent-linux' ========================================================
[==- defaults: [R2:release2, R3:master]
[===============================================================================
GIT_URL_core_agent_linux = $(GITHUB_PREFIX)/core-agent-linux.git
BRANCH_core_agent_linux = $(word $(RELEASE_INDEX), release2 r3-templates)


[==- 'gui-agent-linux'==========================================================
[==- defaults: [R2:release2, R3:master]
[==- git diff debian..upstream/release2
[==- '*** upstream still missing appvm-scripts/usrbin/qubes-session commit ***'
[===============================================================================
GIT_URL_gui_agent_linux = $(GITHUB_PREFIX)/gui-agent-linux.git
BRANCH_gui_agent_linux = $(word $(RELEASE_INDEX), r2-templates r3-templates)


[==- 'qubes-app-linux-pdf-converter' ===========================================
[==- defaults: [R2:master, R3:master]
[==- '*** (for fc21) ***'
[===============================================================================
GIT_URL_qubes_app_linux_pdf_converter = $(GITHUB_PREFIX)/qubes-app-linux-pdf-converter.git
BRANCH_qubes_app_linux_pdf_converter = $(word $(RELEASE_INDEX), fc21 fc21)


[==- 'core-vchan-xen' ==========================================================
[==- defaults: [R2:release2, R3:master]
[==- '*** (for xubuntu) ***'
[===============================================================================
GIT_URL_core_vchan_xen = $(GITHUB_PREFIX)/core-vchan-xen.git
BRANCH_core_vchan_xen = $(word $(RELEASE_INDEX), r2-templates r3-templates)


[==- 'vmm-xen' =================================================================
[==- defaults: [R2:release2, R3:master]
[===============================================================================
GIT_URL_vmm_xen = $(GITHUB_PREFIX)/vmm-xen.git
BRANCH_vmm_xen = $(word $(RELEASE_INDEX), r2-templates r3-templates)


[==- 'linux-utils' =============================================================
[==- defaults: [R2:release2, R3:master]
[===============================================================================
GIT_URL_linux_utils = $(GITHUB_PREFIX)/linux-utils.git
BRANCH_linux_utils = $(word $(RELEASE_INDEX), release2 r3-templates)


[===============================================================================
[==-                   'C U S T O M   T A R G E T S'
[===============================================================================
.PHONY: get-sources
get-sources:: nrgaway-keyring

.PHONY: nrgaway-keyring
nrgaway-keyring::
	# nrgaway Keyring
	# calling verify-git-tag.sh will create keyrings dir and add developer keys
	@dir="$$(readlink -m .)"; \
	KEYRING_DIR_GIT="$$dir/keyrings/git"; \
	export GNUPGHOME="$$(readlink -m $$KEYRING_DIR_GIT)"; \
	./verify-git-tag.sh; \
	echo 'E0E32283FDCAC1A510078F271BB9B1FB5A4C6DAD:6:' | gpg --import-ownertrust; \
	gpg --import nrgaway-qubes-signing-key.asc; \
	gpg --list-keys; \
	touch "$$GNUPGHOME/pubring.gpg"

about::
	@echo "override.conf"

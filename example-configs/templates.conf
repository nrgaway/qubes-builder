# Configuration file for qubes-builder
#
# All lines which begins with "#" are treated as comments
# Assigments can be made with VAR_NAME="VALUE" 
# IMPORTANT: no spaces around "="
#
# This configuration file will be linked to by setup as builder.conf if 
# release 2 is selected.
#
# The release 3 configuration file is 99% duplicated, but by design to 
# allow directly modifications to these files by release.  All the 
# following variable declarations must happen before setup.conf is imported
# since setup.conf relies on these values to compute proper configuration.

-include builder-release.conf
RELEASE ?= 2
RELEASE_INDEX = $(shell echo "$(RELEASE)-1" | bc)

ifeq ($(RELEASE), 2)
  -include example-configs/qubes-os-r2.conf
  BRANCH = release2
else
  -include example-configs/qubes-os-master.conf
endif

GIT_PREFIX ?= marmarek/

DEBUG = 0
VERBOSE = 0
NO_SIGN = 1

DIST_DOM0 := fc20

ifndef DISTS_DEFINED
  DISTS_VM := 
  DISTS_VM += wheezy
  DISTS_VM += wheezy+flash
  DISTS_VM += wheezy+gnome
  DISTS_VM += wheezy+gnome+flash
  DISTS_VM += jessie
  DISTS_VM += jessie+flash
  DISTS_VM += jessie+gnome
  DISTS_VM += jessie+gnome+flash
  DISTS_VM += trusty
  DISTS_VM += trusty+flash
  DISTS_VM += trusty+desktop
  DISTS_VM += trusty+desktop+flash
  DISTS_VM += utopic
  DISTS_VM += utopic+flash
  DISTS_VM += utopic+desktop
  DISTS_VM += utopic+desktop+flash
  DISTS_VM += vivid
  DISTS_VM += vivid+flash
  DISTS_VM += vivid+desktop
  DISTS_VM += vivid+desktop+flash
  DISTS_VM += wheezy+whonix-gateway
  DISTS_VM += wheezy+whonix-workstation
  DISTS_VM += wheezy+whonix-workstation+flash
  DISTS_VM += wheezy+whonix-workstation+gnome
  DISTS_VM += wheezy+whonix-workstation+gnome+flash
  DISTS_VM += fc20
  DISTS_VM += fc20+minimal
  DISTS_VM += fc20+fullyloaded
  DISTS_VM += fc21
  DISTS_VM += fc21+minimal
  DISTS_VM += fc21+fullyloaded
endif

TEMPLATE_LABEL ?=
TEMPLATE_LABEL += wheezy:debian-7-x64
TEMPLATE_LABEL += wheezy+flash:debian-7-x64
TEMPLATE_LABEL += wheezy+gnome:debian-7-x64-gnome
TEMPLATE_LABEL += wheezy+gnome+flash:debian-7-x64-gnome
TEMPLATE_LABEL += jessie:debian-8-x64
TEMPLATE_LABEL += jessie+flash:debian-8-x64
TEMPLATE_LABEL += jessie+gnome:debian-8-x64-gnome
TEMPLATE_LABEL += jessie+gnome+flash:debian-8-x64-gnome
TEMPLATE_LABEL += trusty:ubuntu-trusty-x64
TEMPLATE_LABEL += trusty+flash:ubuntu-trusty-x64
TEMPLATE_LABEL += trusty+desktop:ubuntu-trusty-x64-desktop
TEMPLATE_LABEL += trusty+desktop+flash:ubuntu-trusty-x64-desktop
TEMPLATE_LABEL += utopic:ubuntu-utopic-x64
TEMPLATE_LABEL += utopic+flash:ubuntu-utopic-x64
TEMPLATE_LABEL += utopic+desktop:ubuntu-utopic-x64-desktop
TEMPLATE_LABEL += utopic+desktop+flash:ubuntu-utopic-x64-desktop
TEMPLATE_LABEL += vivid:ubuntu-vivid-x64
TEMPLATE_LABEL += vivid+flash:ubuntu-vivid-x64
TEMPLATE_LABEL += vivid+desktop:ubuntu-vivid-x64-desktop
TEMPLATE_LABEL += vivid+desktop+flash:ubuntu-vivid-x64-desktop
TEMPLATE_LABEL += wheezy+whonix-gateway:whonix-gateway-experimental
TEMPLATE_LABEL += wheezy+whonix-workstation:whonix-workstation-experimental
TEMPLATE_LABEL += wheezy+whonix-workstation+flash:whonix-workstation-experimental
TEMPLATE_LABEL += wheezy+whonix-workstation+gnome:whonix-workstation-gnome
TEMPLATE_LABEL += wheezy+whonix-workstation+gnome+flash:whonix-workstation-gnome

# Location of Sub-Templates that are not in default location. 
# Example: wheezy+whonix-gateway would normally be in 
#          (Don't Place in {curly} brackets; ending curly gets cut off
#          $$SCRIPTSDIR/wheezy+whonix-gateway
#   -or-   $$SCRIPTSDIR/wheezy
TEMPLATE_FLAVOR_DIR ?= +gnome:$$SCRIPTSDIR/gnome
TEMPLATE_FLAVOR_DIR += +flash:$$SCRIPTSDIR/flash
TEMPLATE_FLAVOR_DIR += +desktop:$$SCRIPTSDIR/desktop

TEMPLATE :=
TEMPLATE += vmm-xen
TEMPLATE += core-vchan-xen
ifeq ($(RELEASE), 3)
  TEMPLATE += core-qubesdb
endif
TEMPLATE += linux-utils
TEMPLATE += core-agent-linux
TEMPLATE += gui-common
TEMPLATE += gui-agent-linux
TEMPLATE += qubes-app-linux-split-gpg
TEMPLATE += qubes-app-linux-tor
TEMPLATE += qubes-app-thunderbird
TEMPLATE += qubes-app-linux-pdf-converter
TEMPLATE += linux-template-builder

# Qubes-builder deps
DEPENDENCIES := rpmdevtools rpm-build createrepo rpm-sign

# Additional for debian template
DEPENDENCIES += debootstrap dpkg-dev

# If setup script was used to build configuration file, load it now
-include setup.conf

ifneq (,$(findstring wheezy+whonix,$(DISTS_VM)))
  # Whonix
  WHONIX_DIR = $(shell readlink -m ./qubes-src/Whonix)
  GIT_URL_Whonix = https://github.com/Whonix/Whonix.git
  BRANCH_Whonix = 9.6
  COMPONENTS += Whonix
  TEMPLATE   += Whonix

  # XXX: Move location to Whonix or Qubes repo
  # qubes-whonix
  GIT_URL_qubes_whonix = http://github.com/nrgaway/qubes-whonix.git
  BRANCH_qubes_whonix = 9.6-1
  COMPONENTS += qubes-whonix
  TEMPLATE   += qubes-whonix

  # whonix-setup-wizard
  GIT_URL_whonix_setup_wizard = https://github.com/Whonix/whonix-setup-wizard.git
  BRANCH_whonix_setup_wizard = 0.5-1
  COMPONENTS += whonix-setup-wizard
  TEMPLATE += whonix-setup-wizard

  # python-guimessages
  GIT_URL_python_guimessages = https://github.com/Whonix/python-guimessages.git
  BRANCH_python_guimessages = 0.3-1
  COMPONENTS += python-guimessages
  TEMPLATE += python-guimessages
endif

# Contains mostly additional targets specific for templates or Whonix
-include example-configs/extended-rules.conf

.PHONY: about release
about::
	@echo "templates.conf"

release:
	@echo "$(RELEASE)"

